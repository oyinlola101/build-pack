#!/usr/bin/env bash

set -e  # Exit on first error
set -o pipefail  # Fail on first command in a pipeline
set -u  # Treat unset variables as an error

# Set variables
BUILD_DIR="${1:-/tmp/build}"
CACHE_DIR="${2:-/tmp/cache}"

# Ensure non-interactive installation
export DEBIAN_FRONTEND=noninteractive

echo "-----> Installing dependencies..."

# Install Node Version Manager (nvm)
export NVM_DIR="$BUILD_DIR/.nvm"
mkdir -p "$NVM_DIR"
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash

# Source nvm
echo "-----> Sourcing nvm..."
source "$NVM_DIR/nvm.sh"

# Install Node.js and Yarn
NODE_VERSION="16.13.0"
echo "-----> Installing Node.js $NODE_VERSION and Yarn..."
nvm install "$NODE_VERSION"
nvm use "$NODE_VERSION"
npm install -g npm@latest yarn

# Install Golang
GO_VERSION="1.17.6"
GO_TAR="go$GO_VERSION.linux-amd64.tar.gz"
GO_URL="https://golang.org/dl/$GO_TAR"
echo "-----> Installing Go
