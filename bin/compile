#!/usr/bin/env bash

# Set variables
BUILD_DIR=$1
CACHE_DIR=$2

# Ensure the script is run in non-interactive mode
export DEBIAN_FRONTEND=noninteractive

# Configure dpkg and install dependencies
dpkg --configure -a && \
apt-get update && \
apt-get install -y \
  curl \
  python3 python3-pip \
  default-jre default-jdk \
  gcc g++ \
  golang-go && \
curl -fsSL https://deb.nodesource.com/setup_16.x | bash - && \
apt-get install -y nodejs && \
npm install -g npm@9.7.2 yarn && \
rm -rf /var/lib/apt/lists/*

# Copy application code to build directory
cp -r . "$BUILD_DIR"

# Change to the build directory
cd "$BUILD_DIR"

# Install application dependencies using Yarn
yarn install

# Output a success message
echo "-----> Oyin's Buildpack compilation complete "
